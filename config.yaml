# gin-doh Configuration Example
# DNS-over-HTTPS Server Configuration

server:
  listen: ":8080"
  
  # TLS Configuration
  tls:
    enabled: false
    cert_file: /path/to/cert.pem
    key_file: /path/to/key.pem
    
    # ECH (Encrypted Client Hello) Configuration
    ech:
      # Server-side ECH configuration
      enabled: false                    # Enable ECH
      config_file: /path/to/ech-config.list    # ECH config list file (sent to clients)
      key_file: /path/to/ech-key.pem           # ECH private key file
      public_name: dns.example.com             # Public name (for ECH)
      retry_config_file: /path/to/ech-retry.list # ECH retry config file (optional)
      
      # Client-side ECH configuration (for connecting to upstream DoH servers)
      config_list_file: /path/to/upstream-ech.list # Upstream ECH config list
  
  # HTTP/2 Configuration
  http2:
    enabled: true
  
  # HTTP/3 Configuration
  http3:
    enabled: false
  
  # DNS query paths
  dns_paths:
    - path: /dns-query
      enabled: true
    - path: /resolve
      enabled: true
  
  # Rate limiting
  rate_limit:
    enabled: false
    requests_per: 100
    burst: 200
    max_query_size: 65535

# Upstream DNS Server Configuration
upstream:
  # Selection strategy: round-robin, failover, fastest
  strategy: round-robin
  
  # Health check (for failover mode)
  health_check:
    enabled: true
    interval: 30s
    failure_threshold: 3
    recovery_threshold: 2
  
  # Fastest response config (for fastest mode)
  fastest_config:
    window_size: 100
    min_samples: 10
    cooldown: 60s
  
  # Global proxy configuration (optional)
  proxy:
    enabled: false
    type: socks5          # http or socks5
    address: 127.0.0.1:1080
    # username: user
    # password: pass
  
  # Upstream server list
  servers:
    # DoH server (with ECH support)
    # - protocol: doh
    #   url: https://cloudflare-dns.com/dns-query
    #   timeout: 10s
    #   # ECH client configuration (optional, overrides global config)
    #   ech:
    #     enabled: true
    #     config_list: ""   # ECH config list (Base64 or file path)
    
    - protocol: doh
      url: https://dns.google/dns-query
      timeout: 10s
    
    # DoT server
    # - protocol: dot
    #   address: 1.1.1.1:853
    #   server_name: cloudflare-dns.com
    #   timeout: 10s
    
    # UDP DNS
    # - protocol: udp
    #   address: 8.8.8.8:53
    #   timeout: 5s
    
    # - protocol: udp
    #   address: 1.1.1.1:53
    #   timeout: 5s
    
    # TCP DNS
    # - protocol: tcp
    #   address: 8.8.8.8:53
    #   timeout: 5s

# Logging Configuration
logging:
  level: info              # debug, info, warn, error
  format: json             # json or console
  output: stdout
  
  # Log fields
  fields:
    - timestamp
    - client_ip
    - method
    - path
    - query_name
    - query_type
    - upstream
    - upstream_protocol
    - response_code
    - latency_ms
    - status
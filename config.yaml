# gin-doh Configuration Example
# DNS-over-HTTPS Server Configuration

server:
  listen: ":8080"
  
  # Trusted proxies for real IP extraction
  # When behind a reverse proxy (nginx, cloudflare, etc.), configure the proxy IPs here
  # to extract the real client IP from X-Forwarded-For, X-Real-IP, or True-Client-IP headers
  # Supports: single IPs, CIDR ranges (e.g., "10.0.0.0/8", "192.168.1.0/24")
  # Common examples:
  #   - Cloudflare: 173.245.48.0/20, 103.21.244.0/22, 103.22.200.0/22, 103.31.4.0/22, 141.101.64.0/18, 108.162.192.0/18, 190.93.240.0/20, 188.114.96.0/20, 197.234.240.0/22, 198.41.128.0/17, 162.158.0.0/15, 104.16.0.0/13, 104.24.0.0/14, 172.64.0.0/13, 131.0.72.0/22
  #   - Local reverse proxy: 127.0.0.1, ::1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
  # Leave empty or omit to trust all proxy headers (not recommended for production)
  trusted_proxies: []
  # trusted_proxies:
  #   - 127.0.0.1
  #   - 10.0.0.0/8
  #   - 172.16.0.0/12
  #   - 192.168.0.0/16
  
  # Custom header for real client IP (optional)
  # When set, this header will be checked first for the client IP
  # Useful for CDNs like Cloudflare: CF-Connecting-IP
  # real_ip_header: CF-Connecting-IP
  
  # TLS Configuration
  tls:
    enabled: false
    cert_file: certs/cert.pem
    key_file: certs/key.pem
    
    # ECH (Encrypted Client Hello) Configuration
    ech:
      # Server-side ECH configuration
      enabled: false                    # Enable ECH
      config_file: /path/to/ech-config.list    # ECH config list file (sent to clients)
      key_file: /path/to/ech-key.pem           # ECH private key file
      public_name: dns.example.com             # Public name (for ECH)
      retry_config_file: /path/to/ech-retry.list # ECH retry config file (optional)
      
      # Client-side ECH configuration (for connecting to upstream DoH servers)
      config_list_file: /path/to/upstream-ech.list # Upstream ECH config list
  
  # HTTP/2 Configuration
  http2:
    enabled: true
  
  # HTTP/3 Configuration
  http3:
    enabled: false
  
  # DNS query paths
  dns_paths:
    - path: /dns-query
      enabled: true
    - path: /resolve
      enabled: true
  
  # Rate limiting
  rate_limit:
    enabled: false
    requests_per: 100
    burst: 200
    max_query_size: 65535

# Upstream DNS Server Configuration
upstream:
  # Selection strategy: round-robin, failover, fastest
  strategy: round-robin
  
  # Health check (for failover mode)
  health_check:
    enabled: true
    interval: 30s
    failure_threshold: 3
    recovery_threshold: 2
  
  # Fastest response config (for fastest mode)
  fastest_config:
    window_size: 100
    min_samples: 10
    cooldown: 60s
  
  # Global proxy configuration (optional)
  proxy:
    enabled: false
    type: socks5          # http or socks5
    address: 127.0.0.1:1080
    # username: user
    # password: pass
  
  # Upstream server list
  servers:
    # DoH server (with ECH support)
    # - protocol: doh
    #   url: https://cloudflare-dns.com/dns-query
    #   timeout: 10s
    #   # ECH client configuration (optional, overrides global config)
    #   ech:
    #     enabled: true
    #     config_list: ""   # ECH config list (Base64 or file path)
    
    - protocol: doh
      url: https://dns.google/dns-query
      timeout: 10s
    
    # DoT server
    # - protocol: dot
    #   address: 1.1.1.1:853
    #   server_name: cloudflare-dns.com
    #   timeout: 10s
    
    # UDP DNS
    # - protocol: udp
    #   address: 8.8.8.8:53
    #   timeout: 5s
    
    # - protocol: udp
    #   address: 1.1.1.1:53
    #   timeout: 5s
    
    # TCP DNS
    # - protocol: tcp
    #   address: 8.8.8.8:53
    #   timeout: 5s

# Logging Configuration
logging:
  level: info              # debug, info, warn, error
  format: json             # json or console
  output: stdout
  
  # Log fields
  fields:
    - timestamp
    - client_ip
    - method
    - path
    - query_name
    - query_type
    - upstream
    - upstream_protocol
    - response_code
    - latency_ms
    - status